<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <meta name="description" />
        <meta name="keywords" content="static content generator,static site generator,static site,HTML,web development,.NET,C#,Razor,Markdown,YAML" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/assets/img/favicon.ico" type="image/x-icon">
        <title>Cake - Cake Kudu - Azure Web Deployment Addin</title>
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/bootstrap/bootstrap.css" rel="stylesheet" />
        <link href="/assets/css/adminlte/AdminLTE.css" rel="stylesheet" />
        <link href="/assets/css/theme/theme.css" rel="stylesheet" />
        <link href="//fonts.googleapis.com/css?family=Roboto+Mono:400,700|Roboto:400,400i,700,700i" rel="stylesheet">
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="/assets/css/override.css" rel="stylesheet" />
        <script src="/assets/js/jquery-2.2.3.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>        
        <script src="/assets/js/app.min.js"></script>         
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/jquery.slimscroll.min.js"></script>
        <script src="/assets/js/jquery.sticky-kit.min.js"></script>
        <script src="/assets/js/mermaid.min.js"></script>
        <script src="/assets/js/svg-pan-zoom.min.js"></script>
        <!--[if lt IE 9]>
        <script src="/assets/js/html5shiv.min.js"></script>
        <script src="/assets/js/respond.min.js"></script>
        <![endif]-->  

        <script type="text/javascript" src="/assets/js/anchor.min.js"></script>
    </head>
    <body class="hold-transition wyam layout-boxed  ">    
        <div class="top-banner"></div>
        <div class="wrapper with-container">
            <!-- Header -->
            <header class="main-header">   
                     
                <a href="/" class="logo">

                                <!-- mini logo for sidebar mini 50x50 pixels -->
                                <span class="logo-mini"><img src="/assets/img/logo.png"></span>
                                <!-- logo for regular state and mobile devices -->
                                <span class="logo-lg"><img src="/assets/img/logo.png"></span>
                                            </a>   
                         
                <nav class="navbar navbar-static-top" role="navigation">
                    <!-- Sidebar toggle button-->
                        <a href="#" class="sidebar-toggle visible-xs-block" data-toggle="offcanvas" role="button">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-right"></i>
                        </a>
                                        
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
                            <span class="sr-only">Toggle side menu</span>
                            <i class="fa fa-chevron-circle-down"></i>
                        </button>
                    </div>
            
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse pull-left" id="navbar-collapse">
                        <ul class="nav navbar-nav">                            
                                    <li class="active"><a href="/blog">Blog</a></li>
        <li><a href="/docs">Documentation</a></li>
        <li><a href="/dsl">Reference</a></li>
        <li><a href="/addins">Addins</a></li>
        <li><a href="/api">API</a></li>
        <li><a href="/faq">FAQ</a></li>
        <li><a href="https://github.com/cake-build/cake"><i class="fa fa-github"></i> Source</a></li>
 
                        </ul>       
                    </div>
                    <!-- /.navbar-collapse -->
                
                    <!-- Navbar Right Menu -->
                </nav>
            </header>
            
            <!-- Left side column. contains the logo and sidebar -->
            <aside class="main-sidebar ">
                <section class="infobar" data-spy="affix" data-offset-top="60" data-offset-bottom="200"> 
                    	
        <div><p><a href="https://github.com/cake-build/website/blob/develop/input/blog/2015-10-22-cake-addin-kudu.md"><i class="fa fa-pencil-square" aria-hidden="true"></i> Edit Content</a></p></div>
    <div id="infobar-headings"></div>

                </section>
                <section class="sidebar">    
                                     
                    

                    <ul class="sidebar-menu">
                        

        <li class="header"><i class="fa fa-bookmark"></i> Categories</li>    
            <li><a href="/blog/Addins">Addins</a></li>
            <li><a href="/blog/Announcement">Announcement</a></li>
            <li><a href="/blog/How-Tos">How To&#x27;s</a></li>
            <li><a href="/blog/Infrastructure">Infrastructure</a></li>
            <li><a href="/blog/News">News</a></li>
            <li><a href="/blog/Release-Notes">Release Notes</a></li>
    
    <li class="header"><i class="fa fa-calendar"></i> Archive</li>    
        <li><a href="/blog/archive/2019/04">April, 2019</a></li>
        <li><a href="/blog/archive/2019/01">January, 2019</a></li>
        <li><a href="/blog/archive/2018/12">December, 2018</a></li>
        <li><a href="/blog/archive/2018/08">August, 2018</a></li>
        <li><a href="/blog/archive/2018/07">July, 2018</a></li>
        <li><a href="/blog/archive/2018/06">June, 2018</a></li>
        <li><a href="/blog/archive/2018/05">May, 2018</a></li>
        <li><a href="/blog/archive/2018/04">April, 2018</a></li>
        <li><a href="/blog/archive/2018/03">March, 2018</a></li>
        <li><a href="/blog/archive/2018/02">February, 2018</a></li>
        <li><a href="/blog/archive/2018/01">January, 2018</a></li>
        <li><a href="/blog/archive/2017/12">December, 2017</a></li>
        <li><a href="/blog/archive/2017/11">November, 2017</a></li>
        <li><a href="/blog/archive/2017/10">October, 2017</a></li>
        <li><a href="/blog/archive/2017/09">September, 2017</a></li>
        <li><a href="/blog/archive/2017/08">August, 2017</a></li>
        <li><a href="/blog/archive/2017/07">July, 2017</a></li>
        <li><a href="/blog/archive/2017/06">June, 2017</a></li>
        <li><a href="/blog/archive/2017/05">May, 2017</a></li>
        <li><a href="/blog/archive/2017/04">April, 2017</a></li>
        <li><a href="/blog/archive/2017/03">March, 2017</a></li>
        <li><a href="/blog/archive/2017/01">January, 2017</a></li>
        <li><a href="/blog/archive/2016/12">December, 2016</a></li>
        <li><a href="/blog/archive/2016/11">November, 2016</a></li>
        <li><a href="/blog/archive/2016/10">October, 2016</a></li>
        <li><a href="/blog/archive/2016/09">September, 2016</a></li>
        <li><a href="/blog/archive/2016/08">August, 2016</a></li>
        <li><a href="/blog/archive/2016/07">July, 2016</a></li>
        <li><a href="/blog/archive/2016/06">June, 2016</a></li>
        <li><a href="/blog/archive/2016/05">May, 2016</a></li>
        <li><a href="/blog/archive/2016/04">April, 2016</a></li>
        <li><a href="/blog/archive/2016/03">March, 2016</a></li>
        <li><a href="/blog/archive/2016/02">February, 2016</a></li>
        <li><a href="/blog/archive/2016/01">January, 2016</a></li>
        <li><a href="/blog/archive/2015/12">December, 2015</a></li>
        <li><a href="/blog/archive/2015/11">November, 2015</a></li>
        <li><a href="/blog/archive/2015/10">October, 2015</a></li>
        <li><a href="/blog/archive/2015/09">September, 2015</a></li>
        <li><a href="/blog/archive/2015/08">August, 2015</a></li>
        <li><a href="/blog/archive/2015/07">July, 2015</a></li>
    
        <li class="header"><i class="fa fa-user"></i> Authors</li>    
            <li><a href="/blog/author/agc93">agc93</a></li>
            <li><a href="/blog/author/daveaglick">daveaglick</a></li>
            <li><a href="/blog/author/devlead">devlead</a></li>
            <li><a href="/blog/author/gep13">gep13</a></li>
            <li><a href="/blog/author/jericho">jericho</a></li>
            <li><a href="/blog/author/Larz-White">Larz White</a></li>
            <li><a href="/blog/author/mholo65">mholo65</a></li>
            <li><a href="/blog/author/Pascal-Berger">Pascal Berger</a></li>
            <li><a href="/blog/author/patriksvensson">patriksvensson</a></li>
            <li><a href="/blog/author/phillipsj">phillipsj</a></li>
            <li><a href="/blog/author/RLittlesII">RLittlesII</a></li>

                    </ul>
                            
                </section>                
            </aside>
            
            <!-- Content Wrapper. Contains page content -->
            <div class="content-wrapper">
                



		<section class="content-header">
			<h1>Cake Kudu - Azure Web Deployment Addin</h1>
		</section>
	<section class="content">
		



<dl class="dl-horizontal" style="margin-bottom: 12px;">
    <dt style="text-align: left;"><i class="fa fa-calendar"></i> Published</dt>
    <dd>Thursday, October 22, 2015</dd>
        <dt style="text-align: left;"><i class="fa fa-bookmark"></i> Category</dt>
        <dd><a href="/blog/Addins">Addins</a></dd>
            <dt style="text-align: left;"><i class="fa fa-user"></i> Author</dt>
        <dd><a href="/blog/author/devlead">devlead</a></dd>
</dl>


<p>Wouldn't it be great if you could fully control your <em>Azure web app deployments</em>, have them <em>configuration</em> and <em>environment</em> driven and all this orchestrated using C#? Well it turns out with Cake Kudu <em>you</em> can!</p>
<!--excerpt-->
<h3 id="kudu">Kudu</h3>
<p><a href="https://github.com/projectkudu/kudu">Kudu</a> is the engine behind continuous deployments, WebJobs, and many other features in Azure web apps and mobile services.</p>
<p>Out of the box <em>Kudu</em> allows you to build and deploy you web apps directly on <em>Azure</em> triggered by when you push to your code <em>GitHub</em>, <em>Bitbucket</em>, <em>Visual Studio Online</em>, <em>Dropbox</em> and many more services, it can also host it's own GIT repository so can push directly to Kudu.</p>
<h3 id="cake-kudu">Cake Kudu</h3>
<p><a href="https://github.com/WCOMAB/Cake.Kudu">Cake Kudu</a> is an add-in for the Cake build system which gives you an API to the Kudu deployment environment.</p>
<p>It gives you easy access to</p>
<ul>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/a5ae8623">Deployment paths</a></li>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/3d10564b/d3b19dd0">App settings</a></li>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/3d10564b/43c2776d">Connection strings</a></li>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/499464bd">Source control management</a></li>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/eb1bc85d">Tool paths</a></li>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/fadcc0d6">Web site information</a></li>
<li><a href="https://cakebuild.net/api/cake.kudu.provider/3d10564b/10367dab">Deployment sync file/folder methods</a></li>
</ul>
<h3 id="super-charging-kudu">Super charging Kudu</h3>
<p>So what does <a href="https://cakebuild.net">Cake</a> and the <a href="https://github.com/WCOMAB/Cake.Kudu">Cake Kudu</a> add-in bring to the table? It will let you do custom build, test and deploy scripts written in C#, driven by convention, environment and configuration.</p>
<p>This enables advanced scenarios like synchronized deployment of multiple web sites (i.e. frontend, API, backoffice) from one repository, adapting build configuration depending on dev/production/geographical region/etc., basically endless possibilities for continuous deployment automation.</p>
<p>It lets you use any of the available aliases and add-ins for Cake, you could post deployment statuses to <a href="https://github.com/WCOMAB/Cake.Slack">Slack</a> / <a href="https://github.com/cake-contrib/Cake.Gitter">Gitter</a>, migrate databases using <a href="https://github.com/RichiCoder1/Cake.AliaSql">AliaSql</a> and much more, all written in a rich, compiled and statically typed language like C# and with the extensive <a href="https://cakebuild.net/dsl">dsl</a> the Cake builds system provides.</p>
<p>You could even use your Azure web app as a build server posting <strong>not</strong> a website but i.e. a build result report to the web.</p>
<h3 id="usage">Usage</h3>
<h4 id="continuous-deployment">Continuous deployment</h4>
<p>First, if you haven't already, you need to enable continuous deployment on your web app, you do that via Settings-&gt;Publishing-&gt;Continuous Deployment and choose the provider that hosts your source code.</p>
<p><img src="https://cloud.githubusercontent.com/assets/1647294/10564229/cc6e3ed8-75ab-11e5-9a58-bf7de894a673.png" class="img-fluid" alt="Continuous deployment" /></p>
<h4 id="deployment">.deployment</h4>
<p>To change the default deployment behavior you have to add an <code>.deployment</code> file the root of to your repository, this tells Kudu what to run on deployment.</p>
<p>Example config file:</p>
<pre><code class="language-ini">[config]
command = deploy.cmd
</code></pre>
<h4 id="deploy.cmd">deploy.cmd</h4>
<p>To enable Cake from the Kudu environment we need a little bootstrapper script that sets up folders and fetches Cake binaries from NuGet and then calls Cake with C# deployment script as parameter.</p>
<p>Example deploy bootstrapper:</p>
<pre><code class="language-dos">&#64;echo off
IF NOT EXIST &quot;Tools&quot; (md &quot;Tools&quot;)
IF NOT EXIST &quot;Tools\Addins&quot; (md &quot;Tools\Addins&quot;)
nuget install Cake -ExcludeVersion -OutputDirectory &quot;Tools&quot;
Tools/Cake/Cake.exe deploy.cake -verbosity=Verbose
</code></pre>
<p>The above script will create the tools &amp; addins folders, fetch Cake from NuGet(upgrade if newer version exists) and launch the Cake build system with a C# script called <code>deploy.cake</code>.</p>
<h4 id="deploy.cake">deploy.cake</h4>
<p>Below is a very basic deployment Cake script.  What it basically does is:</p>
<ol>
<li>Fetches any command line tools needed from NuGet.</li>
<li>Fetches and references any Cake add-ins needed from NuGet.</li>
<li>Sets up global variables and validates that it's running on the Kudu environment.</li>
<li>Cleans any traces of previous builds.</li>
<li>Restores any NuGet packages used by the web app.</li>
<li>Builds/compiles the web app.</li>
<li>If all goes well published the web app.</li>
</ol>
<p>The process is dependency based so if any step would fail the deployment would be aborted and reported as failed in the Azure portal.</p>
<pre><code class="language-csharp">#tool &quot;KuduSync.NET&quot; &quot;https://www.nuget.org/api/v2/&quot;
#addin &quot;Cake.Kudu&quot; &quot;https://www.nuget.org/api/v2/&quot;

///////////////////////////////////////////////////////////////////////////////
// ARGUMENTS
///////////////////////////////////////////////////////////////////////////////

var target          = Argument&lt;string&gt;(&quot;target&quot;, &quot;Default&quot;);
var configuration   = Argument&lt;string&gt;(&quot;configuration&quot;, &quot;Release&quot;);

///////////////////////////////////////////////////////////////////////////////
// GLOBAL VARIABLES
///////////////////////////////////////////////////////////////////////////////

var websitePath     = MakeAbsolute(Directory(&quot;./src/TestWebSite&quot;));
var solutionPath    = MakeAbsolute(File(&quot;./src/TestWebSite.sln&quot;));

if (!Kudu.IsRunningOnKudu)
{
    throw new Exception(&quot;Not running on Kudu&quot;);
}

var deploymentPath = Kudu.Deployment.Target;
if (!DirectoryExists(deploymentPath))
{
    throw new DirectoryNotFoundException(
        string.Format(
            &quot;Deployment target directory not found {0}&quot;,
            deploymentPath
            )
        );
}

///////////////////////////////////////////////////////////////////////////////
// TASK DEFINITIONS
///////////////////////////////////////////////////////////////////////////////

Task(&quot;Clean&quot;)
    .Does(() =&gt;
{
    //Clean up any binaries
    Information(&quot;Cleaning {0}&quot;, websitePath);
    CleanDirectories(websitePath + &quot;/bin&quot;);
});

Task(&quot;Restore&quot;)
    .Does(() =&gt;
{
    // Restore all NuGet packages.
    Information(&quot;Restoring {0}...&quot;, solutionPath);
    NuGetRestore(solutionPath);
});

Task(&quot;Build&quot;)
    .IsDependentOn(&quot;Clean&quot;)
    .IsDependentOn(&quot;Restore&quot;)
    .Does(() =&gt;
{
    // Build all solutions.
    Information(&quot;Building {0}&quot;, solutionPath);
    MSBuild(solutionPath, settings =&gt;
        settings.SetPlatformTarget(PlatformTarget.MSIL)
            .WithProperty(&quot;TreatWarningsAsErrors&quot;,&quot;true&quot;)
            .WithTarget(&quot;Build&quot;)
            .SetConfiguration(configuration));
});

Task(&quot;Publish&quot;)
    .IsDependentOn(&quot;Build&quot;)
    .Does(() =&gt;
{
    Information(&quot;Deploying web from {0} to {1}&quot;, websitePath, deploymentPath);
    Kudu.Sync(websitePath);
});

Task(&quot;Default&quot;)
    .IsDependentOn(&quot;Publish&quot;);

///////////////////////////////////////////////////////////////////////////////
// EXECUTION
///////////////////////////////////////////////////////////////////////////////

RunTarget(target);
</code></pre>
<h4 id="in-action">In action</h4>
<p><img src="https://cloud.githubusercontent.com/assets/1647294/10564139/7449fb3c-75a8-11e5-82ef-b06d4da4a13b.png" class="img-fluid" alt="Azure web app deployment" /></p>
<h3 id="conclusion">Conclusion</h3>
<p>The combination of the Cake build system and Kudu engine proves to be a very powerful and flexible tool for all your deployment needs.</p>


<hr />

<ul class="share-buttons">
  <li><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu&t=Cake%20Kudu%20-%20Azure%20Web%20Deployment%20Addin" title="Share on Facebook" target="_blank"><img alt="Share on Facebook" src="/assets/img/social_flat_rounded_rects_svg/Facebook.svg"></a></li>
  <li><a href="https://twitter.com/intent/tweet?source=http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu&text=Cake%20Kudu%20-%20Azure%20Web%20Deployment%20Addin:%20http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu&via=cakebuildnet" target="_blank" title="Tweet"><img alt="Tweet" src="/assets/img/social_flat_rounded_rects_svg/Twitter.svg"></a></li>
  <li><a href="http://www.reddit.com/submit?url=http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu&title=Cake%20Kudu%20-%20Azure%20Web%20Deployment%20Addin" target="_blank" title="Submit to Reddit"><img alt="Submit to Reddit" src="/assets/img/social_flat_rounded_rects_svg/Reddit.svg"></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu&title=Cake%20Kudu%20-%20Azure%20Web%20Deployment%20Addin&summary=&source=http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu" target="_blank" title="Share on LinkedIn"><img alt="Share on LinkedIn" src="/assets/img/social_flat_rounded_rects_svg/LinkedIn.svg"></a></li>
  <li><a href="mailto:?subject=Cake%20Kudu%20-%20Azure%20Web%20Deployment%20Addin&body=:%20http%3A%2F%2Fcakebuild.net%2Fblog%2F2015%2F10%2Fcake-addin-kudu" target="_blank" title="Send email"><img alt="Send email" src="/assets/img/social_flat_rounded_rects_svg/Email.svg"></a></li>
</ul>

	</section>
                
            </div>           
            
            <!-- Footer -->
            <footer class="main-footer">
            </footer>
            
        </div>
        <div class="wrapper bottom-wrapper">
            <footer class="bottom-footer">
                <p class="text-muted">
    <a href="https://github.com/cake-build/cake"><i class="fa fa-github"></i> GitHub</a> |
    <a href="https://twitter.com/cakebuildnet"><i class="fa fa-twitter"></i> Twitter</a> |
    <a href="https://gitter.im/cake-build/cake"><i class="fa fa-comment"></i> Gitter</a>
    <br/>
    Copyright &copy; <a href="http://dotnetfoundation.org">.NET Foundation</a> and contributors.
    <br/>
    Generated by <a href="http://wyam.io">Wyam</a>
</p>

<script>
    anchors.add();
</script>
            </footer>
        </div>
        <a href="javascript:" id="return-to-top"><i class="fa fa-chevron-up"></i></a>
        <!-- Gitter -->
<script>
    ((window.gitter = {}).chat = {}).options = {
        room: 'cake-build/cake'
    };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

<!-- Google Analytics -->
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-60516413-1', 'auto');
    ga('send', 'pageview');
</script>
        <script>           
            // Close the sidebar if we select an anchor link
            $(".main-sidebar a[href^='#']:not('.expand')").click(function(){
                $(document.body).removeClass('sidebar-open');
            });
            
            $(document).ready(function() {
                mermaid.initialize(
                {
                    flowchart:
                    {
                        useMaxWidth: false
                    },
					startOnLoad: false,
					cloneCssStyles: false
                });     
                mermaid.init(undefined, ".mermaid");

                // Remove the max-width setting that Mermaid sets
                var mermaidSvg = $('.mermaid svg');
                mermaidSvg.addClass('img-responsive');
                mermaidSvg.css('max-width', '');

                // Make it scrollable
				var target = document.querySelector(".mermaid svg");
				if(target !== null)
				{
					var panZoom = window.panZoom = svgPanZoom(target, {
						zoomEnabled: true,
						controlIconsEnabled: true,
						fit: true,
						center: true,
                        maxZoom: 20,
                        zoomScaleSensitivity: 0.6
					});			                          

                    // Do the reset once right away to fit the diagram
                    panZoom.resize();
                    panZoom.fit();
                    panZoom.center();
                    
                    $(window).resize(function(){
                        panZoom.resize();
                        panZoom.fit();
                        panZoom.center();
                    });
				}
                
                $('pre code').each(function(i, block) {
                    hljs.highlightBlock(block);
                });  
            });

            hljs.initHighlightingOnLoad();

            // Back to top
            $(window).scroll(function() {
                if ($(this).scrollTop() >= 200) {        // If page is scrolled more than 50px
                    $('#return-to-top').fadeIn(1000);    // Fade in the arrow
                } else {
                    $('#return-to-top').fadeOut(1000);   // Else fade out the arrow
                }
            });
            $('#return-to-top').click(function() {      // When arrow is clicked
                $('body,html').animate({
                    scrollTop : 0                       // Scroll to top of body
                }, 500);
            });
        </script>
    </body>
</html>